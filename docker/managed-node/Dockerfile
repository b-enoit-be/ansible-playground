FROM alpine

LABEL org.opencontainers.image.authors="Beno√Æt Geeraerts [https://b.enoit.be]"
LABEL ansible_type=nodes

RUN apk add --no-cache \
        openssh \
        py3-jmespath \
    && ssh-keygen -A \
    && mkdir /root/.ssh \
    && chmod 0700 /root/.ssh \
    && echo "root:$(openssl rand 96 | openssl enc -A -base64)" | chpasswd \
    && ln -s /etc/ssh/ssh_host_ed25519_key.pub /root/.ssh/authorized_keys

EXPOSE 22

CMD ["/usr/sbin/sshd", "-D", "-e"]