services:
{% for item in nodes | dict2items %}
  node_{{ item.key }}:
    image: "benoitbe/ansible-node:{{ item.key }}"
    build:
      context: /var/empty
      dockerfile: "/usr/local/bin/templates/{{ item.key }}.Dockerfile"
    deploy:
      replicas: "{{ item.value }}"
    networks:
      - ansible_default
    volumes:
      - ansible_public_ssh_key:/usr/local/share/.ssh
{% endfor %}

networks:
  ansible_default:
    external: true

volumes:
  ansible_public_ssh_key:
    external: true