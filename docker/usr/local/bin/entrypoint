#!/usr/bin/env ash

cp ~/.ssh/id_ed25519.pub /usr/local/share/.ssh/id_ed25519.pub

ansible --module-name template \
    --args "src=docker/nodes/compose.yml.j2 dest=docker/nodes/compose.yml" \
    --extra-vars "distributions='""$(cd docker/nodes && ls -d */)""'" \
    localhost

COMPOSE_IGNORE_ORPHANS=True docker compose \
    --file docker/nodes/compose.yml \
    up \
    --detach

exec "$@"